(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{5219:(e,a,r)=>{Promise.resolve().then(r.bind(r,2303))},6327:(e,a,r)=>{"use strict";r.d(a,{A:()=>l});var t=r(2983),i=r(5155);let l=(0,t.A)((0,i.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close")},1118:(e,a,r)=>{"use strict";r.d(a,{A:()=>l});var t=r(2983),i=r(5155);let l=(0,t.A)((0,i.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu")},2303:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>_});var t=r(5155),i=r(2115),l=r(6046),n=r(7873),s=r(4644),o=r(6240),c=r(3716),u=r.n(c),d=r(3126);function _(){var e,a;let r=(0,l.useRouter)(),[c,_]=(0,i.useState)(!0),[p,f]=(0,i.useState)(null),[v,m]=(0,i.useState)(null),[h,g]=(0,i.useState)(!1),N=(0,i.useRef)(null),[x,j]=(0,i.useState)(!1),[C,b]=(0,i.useState)(""),[S,y]=(0,i.useState)(!1),[w,k]=(0,i.useState)(""),{withLoading:B}=(0,d.pJ)();(0,i.useEffect)(()=>((async()=>{try{let{data:{session:e}}=await n.N.auth.getSession();if(f(e),!e){r.push("/signin");return}let{data:a,error:t}=await n.N.from("profiles").select("*").eq("id",e.user.id).single();if(t)console.error("Error fetching profile:",t);else{m({username:(null==a?void 0:a.username)||"User",email:e.user.email||"",avatar_url:null});try{let{data:a}=await n.N.storage.from("profile-pictures").list("public");if(null==a?void 0:a.find(a=>a.name==="".concat(e.user.id,".png"))){let{data:a}=await n.N.storage.from("profile-pictures").download("public/".concat(e.user.id,".png"));if(a){let e=URL.createObjectURL(a);m(a=>a?{...a,avatar_url:e}:null)}}}catch(e){console.error("Storage error:",e)}}_(!1)}catch(e){console.error("Error checking auth:",e),r.push("/signin")}})(),()=>{(null==v?void 0:v.avatar_url)&&URL.revokeObjectURL(v.avatar_url)}),[r,null==v?void 0:v.avatar_url]);let E=async e=>{try{let a=e.target.files;if(!a||0===a.length)return;await B(async()=>{g(!0);let e=a[0],r="public/".concat(p.user.id,".png"),{error:t}=await n.N.storage.from("profile-pictures").upload(r,e,{upsert:!0});if(t)throw t;let{data:i}=await n.N.storage.from("profile-pictures").download(r);if(i){let e=URL.createObjectURL(i);m({...v,avatar_url:e})}g(!1)})}catch(e){console.error("Error uploading image:",e),g(!1)}},P=async()=>{if(C.trim())try{k(""),await B(async()=>{y(!0);let{data:{session:e}}=await n.N.auth.getSession();if(!e){k("Please sign in to update your username");return}let{data:a}=await n.N.from("profiles").select("id").eq("username",C.trim()).single();if(a){k("This username is already taken. Please choose another one.");return}let{error:r}=await n.N.from("profiles").update({username:C.trim()}).eq("id",e.user.id);if(r){k("Error updating username. Please try again.");return}m(e=>e?{...e,username:C.trim()}:null),j(!1),y(!1)})}catch(e){k("An unexpected error occurred. Please try again."),y(!1)}};return c?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-zinc-900",children:(0,t.jsx)(d.qQ,{text:"Loading profile..."})}):p?(0,t.jsxs)("div",{className:u().pageContainer,children:[(0,t.jsx)(s.A,{}),(0,t.jsx)("main",{className:u().mainContent,children:(0,t.jsxs)("div",{className:u().profileCard,children:[(0,t.jsx)("h2",{className:u().title,children:"Your Profile"}),(0,t.jsxs)("div",{className:u().avatarSection,children:[(0,t.jsxs)("div",{className:u().avatarContainer,onClick:()=>{var e;return null===(e=N.current)||void 0===e?void 0:e.click()},children:[(null==v?void 0:v.avatar_url)?(0,t.jsx)("img",{src:v.avatar_url,alt:"Profile",className:u().avatar}):(0,t.jsx)("div",{className:u().avatarPlaceholder,children:(null==v?void 0:null===(a=v.username)||void 0===a?void 0:null===(e=a[0])||void 0===e?void 0:e.toUpperCase())||"?"}),(0,t.jsx)("div",{className:u().avatarOverlay,children:h?"Changing...":"Change Photo"})]}),(0,t.jsx)("input",{type:"file",ref:N,onChange:E,accept:"image/*",className:"hidden"})]}),(0,t.jsxs)("div",{className:u().infoSection,children:[(0,t.jsxs)("div",{className:u().infoItem,children:[(0,t.jsx)("label",{className:u().label,children:"Username"}),x?(0,t.jsxs)("div",{className:u().editContainer,children:[(0,t.jsx)("input",{type:"text",value:C,onChange:e=>b(e.target.value),className:u().editInput,placeholder:"Enter new username",autoFocus:!0}),w&&(0,t.jsx)("p",{className:u().errorMessage,children:w}),(0,t.jsxs)("div",{className:u().editButtons,children:[(0,t.jsx)("button",{onClick:P,disabled:S,className:u().saveButton,children:S?"Updating...":"Save"}),(0,t.jsx)("button",{onClick:()=>{j(!1),b(""),k("")},className:u().cancelButton,disabled:S,children:"Cancel"})]})]}):(0,t.jsxs)("div",{className:u().valueContainer,children:[(0,t.jsx)("p",{className:u().value,children:null==v?void 0:v.username}),(0,t.jsx)("button",{onClick:()=>{b((null==v?void 0:v.username)||""),j(!0),k("")},className:u().editButton,children:"Edit"})]})]}),(0,t.jsxs)("div",{className:u().infoItem,children:[(0,t.jsx)("label",{className:u().label,children:"Email"}),(0,t.jsx)("p",{className:u().value,children:null==v?void 0:v.email})]})]})]})}),(0,t.jsx)(o.A,{})]}):null}},3716:e=>{e.exports={pageContainer:"profile_pageContainer__b2YYr",loadingContainer:"profile_loadingContainer__N3oLv",loadingSpinner:"profile_loadingSpinner__LmX3z",spin:"profile_spin__B8_d_",mainContent:"profile_mainContent__5hJnE",profileCard:"profile_profileCard__HJ2Cz",title:"profile_title__Qm44E",avatarSection:"profile_avatarSection__fZnTm",avatarContainer:"profile_avatarContainer__dZ232",avatar:"profile_avatar__f2UDF",avatarPlaceholder:"profile_avatarPlaceholder__7K8Y6",avatarOverlay:"profile_avatarOverlay__txKOM",infoSection:"profile_infoSection__P_hRi",infoItem:"profile_infoItem__FgGdu",label:"profile_label__fpdK1",value:"profile_value__XHvIw",hidden:"profile_hidden__Fpjnl",valueContainer:"profile_valueContainer__qe_1v",editContainer:"profile_editContainer__XI4Dn",editInput:"profile_editInput__FHQhW",editButtons:"profile_editButtons__GfXZk",editButton:"profile_editButton__oGUfC",saveButton:"profile_saveButton__Vp6f_",cancelButton:"profile_cancelButton__l62qO",errorMessage:"profile_errorMessage__3vub5"}}},e=>{var a=a=>e(e.s=a);e.O(0,[915,836,385,173,983,282,441,517,358],()=>a(5219)),_N_E=e.O()}]);